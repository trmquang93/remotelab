# Transferring to Another Machine

This guide explains how to move the claude-code-remote setup to a new machine or share it
with others.

## What's Portable

The following files can be copied as-is — they contain no machine-specific data:

- `setup.sh` — automated installation script
- `auth-proxy.mjs` — authentication proxy server
- `hash-password.mjs` — password hashing utility
- `claude-ttyd-session` — dtach wrapper script
- `start.sh` / `stop.sh` — service management scripts
- `INSTALL.md`, `TRANSFER.md`, `CONTRIBUTING.md`, `README.md`
- `.gitignore`, `package.json`, `LICENSE`

The following are machine/user-specific and will be regenerated by `setup.sh`:

- `credentials.txt` — your passwords and tunnel details
- Cloudflare tunnel credentials (`~/.cloudflared/*.json`)
- LaunchAgent plists (`~/Library/LaunchAgents/com.*.plist`)
- Runtime config (`~/.config/claude-web/`)

## Transfer Methods

### Method 1: Fresh Installation (Recommended)

The cleanest approach for a new machine or a new user:

1. Clone the repo (or copy just the portable files above) to the new machine.
2. Follow [INSTALL.md](INSTALL.md):
   - Get a domain and connect it to Cloudflare
   - Run `./setup.sh`
   - The script generates all machine-specific files

### Method 2: Reuse Existing Tunnel (Same Domain, Multiple Machines)

If you want to keep the same domain accessible from a second machine:

1. Copy the entire project folder to the new machine.

2. Copy Cloudflare credentials:
   ```bash
   # From the original machine, copy to the new machine at the same paths:
   ~/.cloudflared/cert.pem
   ~/.cloudflared/config.yml
   ~/.cloudflared/<tunnel-id>.json
   ```

3. Install dependencies on the new machine:
   ```bash
   brew install ttyd cloudflared dtach
   npm install -g @anthropic-ai/claude-code
   ```

4. Copy or regenerate LaunchAgent plists (the easiest approach is to re-run `./setup.sh`
   and choose "skip" when asked to create a new tunnel).

5. Start services:
   ```bash
   ./start.sh
   ```

> **Warning**: Both machines will share the same tunnel. Only one should run `cloudflared`
> at a time, or they will compete for the same tunnel connection.

## For Distribution

If you are sharing this project with others (open source or team use):

- Share only the portable files listed above, not `credentials.txt` or any
  `~/.cloudflared/*.json` files.
- Every user runs `./setup.sh` to generate their own unique credentials, tunnel, and domain.

## What Each User Needs

Every user must have their own:

1. **Domain name** — any cheap domain ($1–12/year)
2. **Cloudflare account** — free plan is sufficient
3. **Claude Code CLI authenticated** — `claude login` or `ANTHROPIC_API_KEY` in shell profile
4. **macOS machine** — to run the server

They can share the same installation scripts and architecture.

## Security Considerations

Never share:
- `credentials.txt`
- `~/.cloudflared/*.json` (tunnel credentials)
- Your `ANTHROPIC_API_KEY`
- `~/.config/claude-web/auth.json` (hashed password + salt)

Safe to share:
- Setup scripts and documentation
- Architecture diagrams
- `auth-proxy.mjs`, `claude-ttyd-session`, `hash-password.mjs`

Best practices:
- Each user runs `./setup.sh` — generates unique credentials
- Use different domains or subdomains per user
- Set appropriate file permissions: `chmod 600 credentials.txt`

## Example: Team Setup

Three team members each want their own instance:

1. One person forks the GitHub repo.
2. Each team member clones it and runs `./setup.sh` with their own domain.
3. Result: three independent instances with separate credentials and tunnels.

## Example: Migrating to a New Mac

1. On the old Mac, note your tunnel name from `~/.cloudflared/config.yml`.
2. On the new Mac, clone the repo.
3. Copy `~/.cloudflared/` from old to new.
4. Run `./setup.sh` — when prompted, choose to reuse the existing tunnel.
5. Start services with `./start.sh`.

## Summary

- **New users**: run `./setup.sh` — it handles everything
- **Transfers**: copy scripts, run fresh setup on new machine
- **Distribution**: share scripts, not credentials
- **Teams**: each person runs their own setup
